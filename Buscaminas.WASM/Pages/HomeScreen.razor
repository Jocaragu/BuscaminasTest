@page "/"
@inject HttpClient Http
@inject NavigationManager NavigationManager

<EditForm Model="currentPlayer" OnSubmit="EnterLobby">
	<div>
		<label for="currentPlayerName">What is your name?</label>
		<InputText id="currentPlayerName" @bind-Value="currentPlayer.Name" class="form-control"></InputText>
	</div>
	<br />
	<button type="submit" class="btn btn-success">Enter</button>
</EditForm>

@code {
	Player currentPlayer = new();

	private List<Player> Lobby = new();

	protected override async Task OnInitializedAsync()
	{
		var result = await Http.GetFromJsonAsync<List<Player>>("api/Lobby");
		if(result != null)
		{
			Lobby = result;
		}
	}

	private async Task EnterLobby()
	{
		if (Lobby.Count > 0)
		{
			foreach (var listedPlayer in Lobby)
			{
				if (currentPlayer.Name != null && listedPlayer.Name != null)
				{
					if(currentPlayer.Name == listedPlayer.Name)
					{
						currentPlayer = listedPlayer;
					}
				}
				else
				{
					await RecruitCurrentPlayer();
				}
			}
		}
		else if (Lobby.Count < 1)
		{
			await RecruitCurrentPlayer();
		}

		await Task.Delay(1);

		NavigationManager.NavigateTo($"/game/{currentPlayer.Id}");
	}

	protected async Task RecruitCurrentPlayer()
	{
		await Task.Delay(1);
		//await Http.PostAsJsonAsync("api/Lobby", currentPlayer);
	}
}